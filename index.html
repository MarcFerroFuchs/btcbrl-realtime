<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BTC/BRL em tempo real (1m)</title>

  <style>
    :root {
      --bg:#0b0b0b; --fg:#e6e6e6; --up:#2ecc71; --down:#e74c3c;
    }
    html,body {
      margin:0; height:100%; background:var(--bg); color:var(--fg);
      font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; align-items:center; justify-content:center;
      flex-direction:column;
    }
    .price {
      font-size:4rem; font-weight:800;
    }
    .up { color:var(--up); }
    .down { color:var(--down); }
    .status {
      font-size:0.9rem; margin-top:10px; color:#9aa0a6;
    }
  </style>
</head>
<body>
  <div class="price" id="price">—</div>
  <div class="status" id="status">Carregando…</div>

  <script>
    const SYMBOL = 'BTCBRL';
    const REST_BASE = 'https://api.binance.com';
    let lastPrice = null;

    function fmtBRL(n) {
      try {
        return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 2 });
      } catch {
        return `R$ ${n.toFixed(2)}`;
      }
    }

    async function updatePrice(){
      const statusEl = document.getElementById('status');
      const priceEl = document.getElementById('price');
      try {
        statusEl.textContent = 'Atualizando...';
        const res = await fetch(`${REST_BASE}/api/v3/ticker/price?symbol=${SYMBOL}`);
        if(!res.ok) throw new Error('Falha na requisição');
        const data = await res.json();
        const price = parseFloat(data.price);
        
        priceEl.textContent = fmtBRL(price);
        if(lastPrice !== null) {
          priceEl.classList.toggle('up', price > lastPrice);
          priceEl.classList.toggle('down', price < lastPrice);
        }
        lastPrice = price;
        const now = new Date();
        statusEl.textContent = `Última atualização: ${now.toLocaleTimeString('pt-BR')}`;
      } catch(e) {
        statusEl.textContent = 'Erro ao atualizar';
        console.error(e);
      }
    }

    // Atualiza já na entrada
    updatePrice();
    // E depois a cada 60s
    setInterval(updatePrice, 60000);
  </script>
</body>
</html>
